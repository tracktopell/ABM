DROP DATABASE IF EXISTS APTBLCMGR_DB_TEST;
CREATE DATABASE APTBLCMGR_DB_TEST;
USE APTBLCMGR_DB_TEST;

CREATE TABLE USUARIO(
	EMAIL VARCHAR(64) NOT NULL,
	NOMBRE VARCHAR(128) NOT NULL,
	PASSWORD VARCHAR(255) NOT NULL,
	DEPARTAMENTO VARCHAR(8) NOT NULL,
	HABILITADO INTEGER(1) NOT NULL,
	SALDO DOUBLE NOT NULL,
	PRIMARY KEY(EMAIL)
)ENGINE=InnoDB;

CREATE TABLE ROL_USUARIO(
	ROL   VARCHAR(64) NOT NULL,
	EMAIL VARCHAR(64) NOT NULL,
	PRIMARY KEY(ROL,EMAIL)
)ENGINE=InnoDB;

CREATE TABLE CONCEPTO (
    ID INTEGER(10) NOT NULL AUTO_INCREMENT,
    DESCRIPCION VARCHAR(255) NOT NULL,
    FACTOR_CARGO_ABONO INTEGER(1) NOT NULL,
    PRIMARY KEY(ID)
)ENGINE=InnoDB;

CREATE TABLE REGISTRO (
	ID INTEGER(10) NOT NULL AUTO_INCREMENT,
	EMAIL VARCHAR(64) NOT NULL,
	CONCEPTO_ID INTEGER(10) NOT NULL,
	IMPORTE DOUBLE NOT NULL,
	FECHA TIMESTAMP NOT NULL,
	PRIMARY KEY(ID)
)ENGINE=InnoDB;

ALTER TABLE ROL_USUARIO ADD CONSTRAINT FOREIGN KEY (EMAIL)           REFERENCES USUARIO(EMAIL);
ALTER TABLE REGISTRO    ADD CONSTRAINT FOREIGN KEY (EMAIL)           REFERENCES USUARIO(EMAIL);
ALTER TABLE REGISTRO    ADD CONSTRAINT FOREIGN KEY (CONCEPTO_ID)     REFERENCES CONCEPTO(ID);

